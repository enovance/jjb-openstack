- job:
    name: 'sanity'
    description: 'Run sanity tests against Spinal Stack'
    project-type: freestyle
    wrappers:
      - ansicolor:
          colormap: xterm
    builders:
      - shell: |
          set +e
          # TODO (EmilienM) Need to be moved in config-tools & tempest
          # (Work in progress)
          cp /etc/config-tools/openrc.sh ./smoke/
          ./smoke/smoke-initialize.sh
          ./smoke/smoke-validate.sh
          # ./launch-monitoring-checks.sh
          # ret=$?
          cd /var/lib/jenkins/jobs/sanity/workspace
          ./build_tempest/setup-tempest.sh
          ./configure-tempest.sh -a
          ./run-tempest.sh -v icehouse -p spinal-stack
          ret=$(($? + $ret))
          cp ./build_tempest/tempest/tempest_xunit.xml .

          exit $ret
    publishers:
      - junit:
          results: '*_xunit.xml'
